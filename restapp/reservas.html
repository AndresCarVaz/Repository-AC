<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gesti√≥n de Reservas - Tavolo App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(-45deg, #0b93e2, #7ba3ec, #394e83, #1556ac);
      background-size: 400% 400%;
      animation: gradientMove 10s ease infinite;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    h2 {
      color: #fff;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
      margin-bottom: 20px;
    }

    .card-reserva {
      background: #fff;
      border-radius: 12px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      padding: 15px;
      margin: 10px;
      width: 300px;
      display: inline-block;
      vertical-align: top;
    }

    .acciones button {
      margin: 3px;
    }

    /* Colores de estado */
    .estado-pendiente { border-left: 6px solid #ffc107; }
    .estado-confirmada { border-left: 6px solid #28a745; }
    .estado-cancelada { border-left: 6px solid #dc3545; }
    .estado-finalizada { border-left: 6px solid #007bff; }
    .estado-noshow { border-left: 6px solid #6c757d; }
  </style>
</head>
<body>

  <a href="restapp.html" class="btn btn-light mb-3">üè† Men√∫ Principal</a>
  <a href="mesas.html" class="btn btn-light mb-3">üçΩÔ∏è Mesas</a>

  <h2>Gesti√≥n de Reservas</h2>

  <!-- Bot√≥n para abrir modal -->
  <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#modalReserva">‚ûï Crear Nueva Reserva</button>

  <!-- Modal para crear/editar reserva -->
  <div class="modal fade" id="modalReserva" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="formTitulo" class="modal-title">Crear Nueva Reserva</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-4">
              <input type="text" id="nombreCliente" class="form-control" placeholder="Nombre del Cliente">
              <div class="invalid-feedback">El nombre del cliente es obligatorio</div>
            </div>
            <div class="col-md-2">
              <input type="number" id="numeroPersonas" class="form-control" placeholder="Personas">
              <div class="invalid-feedback">El n√∫mero de personas es obligatorio</div>
            </div>
            <div class="col-md-3">
              <input type="date" id="fechaReserva" class="form-control">
              <div class="invalid-feedback">La fecha de la reserva es obligatoria</div>
            </div>
            <div class="col-md-3">
              <input type="time" id="horaReserva" class="form-control">
              <div class="invalid-feedback">La hora de la reserva es obligatoria</div>
            </div>
            <div class="col-md-4">
              <select id="ocasionEspecial" class="form-select">
                <option value="">Ninguna</option>
                <option value="Cumplea√±os">Cumplea√±os</option>
                <option value="Aniversario">Aniversario</option>
                <option value="Reuni√≥n de Negocios">Reuni√≥n de Negocios</option>
                <option value="Graduaci√≥n">Graduaci√≥n</option>
                <option value="Boda">Boda</option>
                <option value="Cena Familiar">Cena Familiar</option>
                <option value="Otro">Otro</option>
              </select>
            </div>
            <div class="col-md-4">
              <input type="text" id="notasAdicionales" class="form-control" placeholder="Notas adicionales (opcional)">
            </div>
            <div class="col-md-4">
              <select id="idMesaAsignada" class="form-select"></select>
            </div>
            <div class="col-md-4">
              <select id="estado" class="form-select">
                <option value="Pendiente">Pendiente</option>
                <option value="Confirmada">Confirmada</option>
                <option value="Cancelada">Cancelada</option>
                <option value="Finalizada">Finalizada</option>
                <option value="No Show">No Show</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button class="btn btn-success" id="btnGuardar" onclick="guardarReserva()">Guardar Reserva</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="card p-3 mb-3 w-75">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label text-white">Filtrar por Fecha</label>
        <input type="date" id="filtroFecha" class="form-control" onchange="mostrarReservas()">
      </div>
      <div class="col-md-6">
        <label class="form-label text-white">Filtrar por Estado</label>
        <select id="filtroEstado" class="form-select" onchange="mostrarReservas()">
          <option value="">Todos</option>
          <option value="Pendiente">Pendiente</option>
          <option value="Confirmada">Confirmada</option>
          <option value="Cancelada">Cancelada</option>
          <option value="Finalizada">Finalizada</option>
          <option value="No Show">No Show</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Contenedor de reservas -->
  <div id="listaReservas" class="d-flex flex-wrap justify-content-center"></div>

  <script>
    // Inicializar reservas en localStorage
    if (!localStorage.getItem("reservas")) {
      localStorage.setItem("reservas", JSON.stringify([]));
    }
    let reservas = JSON.parse(localStorage.getItem("reservas"));
    let editIndex = null;

    // Cargar mesas disponibles
    function cargarMesas() {
      let mesas = JSON.parse(localStorage.getItem("mesas")) || [];
      let selectMesa = document.getElementById("idMesaAsignada");
      selectMesa.innerHTML = "";
      mesas.forEach(m => {
        if (m.estado === "disponible") {
          let opt = document.createElement("option");
          opt.value = m.id;
          opt.textContent = m.id + " (" + m.capacidad + " pers., " + m.ubicacion + ")";
          selectMesa.appendChild(opt);
        }
      });
    }

    // Guardar o actualizar reserva
    function guardarReserva() {
      let nombreCliente = document.getElementById("nombreCliente");
      let numeroPersonas = document.getElementById("numeroPersonas");
      let fechaReserva = document.getElementById("fechaReserva");
      let horaReserva = document.getElementById("horaReserva");
      let idMesaAsignada = document.getElementById("idMesaAsignada");

      let valido = true;
      [nombreCliente, numeroPersonas, fechaReserva, horaReserva, idMesaAsignada].forEach(el => {
        el.classList.remove("is-invalid");
        if (!el.value || el.value.trim() === "" || (el.type === "number" && el.value <= 0)) {
          el.classList.add("is-invalid");
          valido = false;
        }
      });
      if (!valido) return;

      // Validar que la fecha no sea pasada
      let hoy = new Date().toISOString().split("T")[0];
      if (fechaReserva.value < hoy) {
        alert("La fecha de la reserva no puede ser anterior a hoy");
        return;
      }

      let reserva = {
        idReserva: editIndex !== null ? reservas[editIndex].idReserva : Date.now(),
        nombreCliente: nombreCliente.value.trim(),
        numeroPersonas: numeroPersonas.value.trim(),
        fechaReserva: fechaReserva.value,
        horaReserva: horaReserva.value,
        ocasionEspecial: document.getElementById("ocasionEspecial").value,
        notasAdicionales: document.getElementById("notasAdicionales").value.trim(),
        idMesaAsignada: idMesaAsignada.value,
        estado: document.getElementById("estado").value
      };

      if (editIndex !== null) {
        reservas[editIndex] = reserva;
        editIndex = null;
        document.getElementById("btnGuardar").textContent = "Guardar Reserva";
        document.getElementById("formTitulo").textContent = "Crear Nueva Reserva";
      } else {
        reservas.push(reserva);
      }

      localStorage.setItem("reservas", JSON.stringify(reservas));
      mostrarReservas();
      limpiarFormulario();

      let modal = bootstrap.Modal.getInstance(document.getElementById("modalReserva"));
      modal.hide();
    }

    // Mostrar reservas con filtros
    function mostrarReservas() {
      let contenedor = document.getElementById("listaReservas");
      contenedor.innerHTML = "";

      let filtroFecha = document.getElementById("filtroFecha").value;
      let filtroEstado = document.getElementById("filtroEstado").value;

      reservas
        .filter(r => {
          let ok = true;
          if (filtroFecha && r.fechaReserva !== filtroFecha) ok = false;
          if (filtroEstado && r.estado !== filtroEstado) ok = false;
          return ok;
        })
        .forEach((r, i) => {
          let estadoClase = "estado-" + r.estado.toLowerCase().replace(" ", "");
          let card = document.createElement("div");
          card.className = "card-reserva " + estadoClase;
          card.innerHTML = `
            <h5>Reserva #${r.idReserva}</h5>
            <p><b>Cliente:</b> ${r.nombreCliente}</p>
            <p><b>Personas:</b> ${r.numeroPersonas}</p>
            <p><b>Fecha:</b> ${r.fechaReserva}</p>
            <p><b>Hora:</b> ${r.horaReserva}</p>
            <p><b>Mesa:</b> ${r.idMesaAsignada}</p>
            <p><b>Ocasi√≥n:</b> ${r.ocasionEspecial}</p>
            <p><b>Estado:</b> ${r.estado}</p>
            <div class="acciones">
              <button class="btn btn-primary btn-sm" onclick="editarReserva(${i})">Editar</button>
              <button class="btn btn-info btn-sm" onclick="pagarReserva(${i})">Pagar</button>
              <button class="btn btn-danger btn-sm" onclick="eliminarReserva(${i})">Eliminar</button>
            </div>
          `;
          contenedor.appendChild(card);
        });
    }

    function eliminarReserva(index) {
      reservas.splice(index, 1);
      localStorage.setItem("reservas", JSON.stringify(reservas));
      mostrarReservas();
    }

    function editarReserva(index) {
      let r = reservas[index];
      document.getElementById("nombreCliente").value = r.nombreCliente;
      document.getElementById("numeroPersonas").value = r.numeroPersonas;
      document.getElementById("fechaReserva").value = r.fechaReserva;
      document.getElementById("horaReserva").value = r.horaReserva;
      document.getElementById("ocasionEspecial").value = r.ocasionEspecial;
      document.getElementById("notasAdicionales").value = r.notasAdicionales;
      document.getElementById("idMesaAsignada").value = r.idMesaAsignada;
      document.getElementById("estado").value = r.estado;

      editIndex = index;
      document.getElementById("btnGuardar").textContent = "Actualizar Reserva";
      document.getElementById("formTitulo").textContent = "Editar Reserva";

      let modal = new bootstrap.Modal(document.getElementById("modalReserva"));
      modal.show();
    }

    function pagarReserva(index) {
      alert("üí∞ Funci√≥n de pago pendiente para reserva #" + reservas[index].idReserva);
    }

    function limpiarFormulario() {
      document.getElementById("nombreCliente").value = "";
      document.getElementById("numeroPersonas").value = "";
      document.getElementById("fechaReserva").value = "";
      document.getElementById("horaReserva").value = "";
      document.getElementById("ocasionEspecial").value = "";
      document.getElementById("notasAdicionales").value = "";
      document.getElementById("idMesaAsignada").value = "";
      document.getElementById("estado").value = "Pendiente";
    }

    cargarMesas();
    mostrarReservas();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
